---
title: "Atividade 3: Regressão Linear"
date: 2025-11-23
execute:
    enable: true
---

## Objetivo

Calcular uma regressão linear entre anos de estudo (X) e salário (y) utilizando a fórmula matricial, e gerar um gráfico com os pontos de dados e a reta estimada.

## Implementação

A solução foi desenvolvida utilizando:

- **NumPy**: Para cálculos matriciais
- **Pandas**: Para manipulação de dados
- **Plotnine**: Para criação de gráficos estatísticos (gramática de gráficos similar ao ggplot2 do R)

### Fórmula Matricial

A regressão linear é calculada usando a fórmula matricial:

**β = (X'X)^(-1)X'y**

Onde:
- **X** é a matriz de design (com coluna de 1s para o intercepto)
- **y** é o vetor de respostas
- **β** contém [intercepto, inclinação]

### Funcionamento

O código realiza os seguintes passos:

1. **Leitura dos dados**: Lê os valores de X e y dos arquivos `X.txt` e `y.txt`
2. **Construção da matriz de design**: Cria a matriz X com coluna de 1s e os valores de X
3. **Cálculo dos coeficientes**: Aplica a fórmula matricial para obter intercepto e inclinação
4. **Geração do gráfico**: Cria um gráfico com pontos e reta de regressão

### Código Principal

```python
import numpy as np
import pandas as pd
from plotnine import ggplot, aes, geom_point, geom_abline, ggsave

def calcular_regressao_linear(valores_x, valores_y):
    n = len(valores_x)
    
    # Cria a matriz de design X
    # Primeira coluna: 1s (para o intercepto)
    # Segunda coluna: valores de x (para a inclinação)
    X = np.column_stack([np.ones(n), valores_x])
    
    # Converte y em vetor coluna
    y = valores_y.reshape(-1, 1)
    
    # Calcula X'X (matriz de covariância)
    XtX = np.dot(X.T, X)
    
    # Calcula (X'X)^(-1) (inversa)
    XtX_inv = np.linalg.inv(XtX)
    
    # Calcula X'y
    Xty = np.dot(X.T, y)
    
    # Calcula β = (X'X)^(-1)X'y
    beta = np.dot(XtX_inv, Xty)
    
    # Extrai intercepto (β₀) e inclinação (β₁)
    intercepto = beta[0][0]
    inclinacao = beta[1][0]
    
    return intercepto, inclinacao

def criar_grafico_regressao(valores_x, valores_y, intercepto, inclinacao):
    # Cria um DataFrame
    df = pd.DataFrame({"x": valores_x, "y": valores_y})
    
    # Cria o gráfico usando plotnine
    plot = (
        ggplot(df, aes("x", "y"))
        + geom_point(color="blue", alpha=0.6)  # Pontos dos dados
        + geom_abline(intercept=intercepto, slope=inclinacao, color="red")  # Reta de regressão
    )
    
    # Salva o gráfico
    ggsave(plot, "grafico.png", dpi=300)
    
    return plot
```

### Explicação da Fórmula Matricial

1. **Matriz de Design (X)**: 
   ```
   X = [1  x₁]
       [1  x₂]
       [1  x₃]
       [...]
   ```
   A primeira coluna de 1s permite calcular o intercepto.

2. **Cálculo de X'X**: Multiplica a transposta de X por X, resultando em uma matriz 2x2.

3. **Inversa de X'X**: Calcula a matriz inversa usando `np.linalg.inv()`.

4. **Cálculo de X'y**: Multiplica a transposta de X por y.

5. **Coeficientes**: Multiplica (X'X)^(-1) por X'y para obter os coeficientes.

## Exemplo de Uso

```python
# Lê os dados
valores_x, valores_y = ler_dados("X.txt", "y.txt")

# Calcula a regressão
intercepto, inclinacao = calcular_regressao_linear(valores_x, valores_y)

print(f"Intercepto: {intercepto:.4f}")
print(f"Inclinação: {inclinacao:.4f}")

# Cria o gráfico
grafico = criar_grafico_regressao(valores_x, valores_y, intercepto, inclinacao)
```

## Execução (gerar regressão e gráfico)

O bloco abaixo lê os arquivos `X.txt` e `y.txt`, calcula os coeficientes da regressão usando a fórmula matricial, mostra os valores de intercepto e inclinação e gera `grafico.png`.

```{python}
import numpy as np
from atividade3_regressao_linear import (
    calcular_regressao_linear,
    criar_grafico_regressao,
)
from IPython.display import Image, display

# Carregar dados
valores_x = np.loadtxt("X.txt")
valores_y = np.loadtxt("y.txt")

# Calcula a regressão
intercepto, inclinacao = calcular_regressao_linear(valores_x, valores_y)
print(f"Intercepto: {intercepto:.4f}")
print(f"Inclinação: {inclinacao:.4f}")

# Gera o gráfico e salva em docs/grafico.png
criar_grafico_regressao(valores_x, valores_y, intercepto, inclinacao)

# Exibe o gráfico dentro da página
display(Image("docs/grafico.png"))
```

## Resultado

O gráfico gerado mostra:

- **Pontos azuis**: Representam os dados observados (anos de estudo vs. salário)
- **Reta vermelha**: Representa a reta de regressão estimada (y = a + bx)

A reta de regressão mostra a relação linear estimada entre anos de estudo e salário, permitindo fazer previsões para novos valores.

## Interpretação dos Coeficientes

- **Intercepto (a)**: Valor esperado de y quando x = 0 (salário base)
- **Inclinação (b)**: Mudança esperada em y para cada unidade de aumento em x (aumento de salário por ano de estudo adicional)

## Considerações Técnicas

- **Fórmula matricial**: Mais eficiente computacionalmente para grandes volumes de dados
- **Precisão numérica**: NumPy utiliza operações otimizadas para cálculos matriciais
- **Visualização**: Plotnine oferece uma interface similar ao ggplot2 do R, facilitando a criação de gráficos estatísticos
