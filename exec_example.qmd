---
title: "Execução interativa"
format: html
---

<div class="runner">

```{=html}
<style>
  .runner { display:flex; gap:1rem; align-items:flex-start; }
  .explain { flex:1; padding:0.5rem; border-right:1px solid #e5e7eb; }
  .execute { width:520px; padding:0.5rem; }
  textarea { width:100%; height:240px; font-family:monospace; font-size:13px; }
  pre.output { background:#0f172a; color:#e6f1ff; padding:0.6rem; max-height:260px; overflow:auto; border-radius:4px; }
  button { padding:0.4rem 0.7rem; font-size:14px; }
  .meta { color:#6b7280; font-size:13px; margin-bottom:8px }
</style>

<div>
  <h3>Explicação</h3>
  <p>Escreva aqui a explicação da atividade.</p>
</div>

<div>
  <h3>Execução</h3>
    <textarea id="pycode">import numpy as np
  import pandas as pd
  from plotnine import ggplot, aes, geom_point, geom_abline

  with open("X.txt", 'r') as f:
    valores_x = np.array([float(linha.strip()) for linha in f.readlines()])

  with open("y.txt", 'r') as f:
    valores_y = np.array([float(linha.strip()) for linha in f.readlines()])

  n = len(valores_x)
  if n > 100_000:
    valores_x = valores_x.astype(np.float32)
    valores_y = valores_y.astype(np.float32)

  X = np.column_stack([np.ones_like(valores_x), valores_x])

  beta, *_ = np.linalg.lstsq(X, valores_y, rcond=None)

  a = float(beta[0])
  b = float(beta[1])

  print(f"Intercepto (a): {a:.4f}")
  print(f"Inclinação (b): {b:.4f}")

  df = pd.DataFrame({"x": valores_x, "y": valores_y})

  plot = (
    ggplot(df, aes("x", "y"))
    + geom_point()
    + geom_abline(intercept=a, slope=b)
  )

  plot.save("grafico.png")

  print(plot)
  </textarea>
  <div style="margin-top:.5rem; display:flex; gap:.5rem">
    <button id="run">Run</button>
    <button id="clear">Clear</button>
  </div>
  <h4>Saída</h4>
  <pre class="output" id="out">Carregando Pyodide...</pre>
</div>

<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
<script>
  let pyodideReady = false;
  (async () => {
    try {
      window.pyodide = await loadPyodide();
      pyodideReady = true;
      document.getElementById('out').textContent = 'Pyodide carregado. Clique em Run para executar.';
    } catch (err) {
      document.getElementById('out').textContent = 'Erro ao carregar Pyodide: ' + String(err);
    }
  })();

  async function runCode() {
    const outEl = document.getElementById('out');
    outEl.textContent = 'Executando...';
    if (!pyodideReady) {
      outEl.textContent = 'Pyodide ainda carregando, aguarde um momento.';
      return;
    }
    const code = document.getElementById('pycode').value;
    try {
      const wrapped = `import sys, io\n_buf = io.StringIO()\n_old = sys.stdout\nsys.stdout = _buf\ntry:\n` +
        code.split('\n').map(l => '    ' + l).join('\n') +
        `\nfinally:\n    sys.stdout = _old\n_buf.getvalue()`;
      const result = await pyodide.runPythonAsync(wrapped);
      outEl.textContent = result || '(sem saída)';
    } catch (err) {
      outEl.textContent = String(err);
    }
  }

  document.getElementById('run').addEventListener('click', runCode);
  document.getElementById('clear').addEventListener('click', () => { document.getElementById('out').textContent = ''; });
</script>

```

</div>
